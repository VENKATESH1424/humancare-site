<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OCR Lab Report</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
  .container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);}
  input, button, textarea { width: 100%; margin-top: 10px; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
  textarea { height: 300px; font-family: monospace; white-space: pre-wrap; }
</style>
</head>
<body>
<div class="container">
  <h2>OCR Lab Report</h2>

  <input type="file" id="fileInput" accept="image/*">
  <button id="uploadBtn">Process Report</button>

  <h3>Preview / Edit JSON:</h3>
  <textarea id="jsonPreview" placeholder="JSON will appear here..."></textarea>
  <button id="saveBtn">Save JSON</button>
</div>

<script>
const fileInput = document.getElementById('fileInput');
const uploadBtn = document.getElementById('uploadBtn');
const jsonPreview = document.getElementById('jsonPreview');
const saveBtn = document.getElementById('saveBtn');

uploadBtn.addEventListener('click', async () => {
  if (!fileInput.files[0]) {
    alert('Please select a file first!');
    return;
  }

  const formData = new FormData();
  formData.append('file', fileInput.files[0]);

  try {
    const response = await fetch('https://processlabreport-986623782553.us-central1.run.app', {
      method: 'POST',
      body: formData
    });

    if (!response.ok) throw new Error('Server error');
    const data = await response.json();

    // Pretty print and make it editable
    jsonPreview.value = JSON.stringify(data, null, 2);

  } catch (err) {
    alert('Error processing report: ' + err.message);
  }
});

// Example: Saving edited JSON to console (can be replaced with Firestore later)
saveBtn.addEventListener('click', () => {
  try {
    const edited = JSON.parse(jsonPreview.value);
    console.log('Edited JSON:', edited);
    alert('JSON saved (check console)');
  } catch (err) {
    alert('Invalid JSON: ' + err.message);
  }
});
</script>
</body>
</html>
